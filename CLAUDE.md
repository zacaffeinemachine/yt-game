# YT Feed — Project Context

A personal YouTube feed hosted on GitHub Pages. Shows videos only from
hand-picked channels, with watched/unwatched filtering and an embedded player.
Designed to replace mindless YouTube browsing.

## Architecture

| File | Purpose |
|------|---------|
| `channels.txt` | One channel per line (`@handle` or `UCID`). Edit this to add/remove channels. |
| `scripts/fetch_videos.py` | Calls YouTube Data API v3, filters Shorts, writes `data/videos.json` |
| `data/videos.json` | Auto-generated by the GitHub Action. Never edit by hand. |
| `.github/workflows/fetch-videos.yml` | Runs daily at 05:00 UTC, on push to `channels.txt`, or manually |
| `index.html` / `style.css` / `app.js` | Single-page frontend (no framework, no build step) |
| `deploy.py` | Helper script: commits local changes and pushes to GitHub |

## How to add/remove channels

1. Edit `channels.txt`
2. Run `python3 deploy.py` from the repo root
3. The GitHub Action fires automatically and updates the feed within ~1 minute

## GitHub Action

- **Trigger:** daily cron (05:00 UTC) + push to `channels.txt` + manual dispatch
- **Secret required:** `YOUTUBE_API_KEY` (YouTube Data API v3 key, stored in repo Settings → Secrets)
- **What it does:** resolves each channel handle → fetches up to 200 recent uploads
  (4 pages × 50) → filters out Shorts (≤ 3 min) → keeps 50 longest-recent videos
  → commits updated `data/videos.json` back to `main`
- **Quota cost:** roughly 10 units per channel per run (well within the free 10,000/day limit)

## Frontend behaviour

- Dark minimal UI; no framework, no build step — plain HTML/CSS/JS
- Hash routing: `#` = all channels, `#<channelId>` = single channel
- Watched state stored in browser `localStorage` (per-browser, not synced)
- Clicking a video card opens an embedded player modal (auto-marks as watched)
- The ✓ button on a card toggles watched/unwatched without opening the video
- Filter buttons: All / Unwatched / Watched

## Known issues / decisions

- **Push rejected on deploy:** The Action commits `videos.json` after every run,
  keeping the remote ahead of local. `deploy.py` does `git pull --rebase` before
  pushing to handle this automatically.
- **Shorts filter threshold:** 180 seconds (3 min). YouTube expanded Shorts to
  3 min in late 2024. Adjust `SHORTS_MAX_SECONDS` in `fetch_videos.py` if needed.
- **`forHandle` and google-api-python-client:** The official Python client rejected
  `forHandle` due to a stale discovery cache. Fixed by switching to raw `requests`
  calls instead — no `google-api-python-client` dependency.
- **Watched state is browser-local:** clearing `localStorage` or switching browsers
  resets watched history. A future improvement could use a small backend or
  export/import feature.

## Live site

https://zacaffeinemachine.github.io/yt-game/
